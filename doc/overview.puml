@startuml

package homekit {
    class AccessoryServer {
        + __init__(self, config_file, logger)
        + publish_device()
        + unpublish_device()
        + shutdown()
        + add_accessory()
        + serve_forever()
    }
    package model {
        package services {
            class AbstractService {
                + iid
            }

            class AccessoryInformationService {
            }

            class LightBulbService {
            }

            AccessoryInformationService -up-|> AbstractService
            LightBulbService -up-|> AbstractService
            xxxService -up-|> AbstractService
        }
        package characteristics {
            class AbstractCharacteristic {
                + iid
            }
            xxxCharacteristic -up-|> AbstractCharacteristic
        }

        class Accessory {
            + aid
        }
    }

    AccessoryServer --> "*" Accessory : accessories
    AbstractService -right-> "*" AbstractCharacteristic : characteristics
    Accessory --> "*" AbstractService: services

    package exceptions {
        class HomeKitException
        FormatException -up-|> HomeKitException
        class AuthenticationError
        AuthenticationError -up-|> HomeKitException
        class AccessoryNotFoundException
        class UnknownError
        class ConfigSavingException
        ConfigSavingException -up-|> HomeKitException
        class ConfigLoadingException
        ConfigLoadingException -up-|> HomeKitException
        class AlreadyPairedException
        class HomeKitConfigurationException
        HttpException -up-|> HomeKitException
    }
}

class homekit.Pairing {
    + get_accessories()
    + get_characteristics(characteristics[], include_meta, include_perms, include_type, include_events)
    + get_events(characteristics[], callback_fun, max_events=-1, max_seconds=-1)
    + list_pairings()
    + put_characteristics(characteristics_and_values[], do_conversion)
    + identify()
}

class homekit.Controller {
    + __init__(self, data)
    + get_pairings()
    + load_data(filename)
    + perform_pairing(alias, accessory_id, pin)
    + remove_pairing(alias)
    + save_data(filename)
    + {static}discover(max_seconds)
    + {static}identify(accessory_id)
}



homekit.Pairing "*" <-down- "1" homekit.Controller


class homekit.discover <<(E,#FF7700) executable>> {
    + timeout
}

homekit.discover --> homekit.Controller

class homekit.get_accessories <<(E,#FF7700) executable>> {
    + pairing_data_file
    + alias
    + output_format
}

homekit.get_accessories --> homekit.Controller

class homekit.get_characteristics <<(E,#FF7700) executable>> {
    + pairing_data_file
    + alias
    + characteristics[]
    + meta
    + permissions
    + type
    + events
}

homekit.get_characteristics --> homekit.Controller

class homekit.get_events <<(E,#FF7700) executable>> {
    + pairing_data_file
    + alias
    + characteristics[]
}

homekit.get_events --> homekit.Controller

class homekit.list_pairings <<(E,#FF7700) executable>> {
    + pairing_data_file
    + alias
}

homekit.list_pairings--> homekit.Controller

class homekit.pair <<(E,#FF7700) executable>> {
    + pairing_data_file
    + alias
    + accessory_id
    + pin
}

homekit.pair--> homekit.Controller

class homekit.put_characteristics <<(E,#FF7700) executable>> {
}

homekit.put_characteristics--> homekit.Controller

class homekit.unpair <<(E,#FF7700) executable>> {
    + pairing_data_file
    + alias
}

homekit.unpair --> homekit.Controller


hide <<executable>> methods
hide <<executable>> circle

@enduml


class homekit.Session {
    + {static} create_from_pairing_data(data)
    + {static} create_from_file(file)
    + get(self, url)
    + put(self, url, body, content_type=HttpContentTypes.JSON)
    + post(self, url, body, content_type=HttpContentTypes.JSON)
    + get_from_pairing_data(self, key)
    + set_in_pairing_data(self, key, value)
}

    package exceptions {
        class AuthenticationError
        class HomeKitTypeException
        class AccessoryNotFoundException
        class UnknownError
        class ConfigSavingException
        class AlreadyPairedException
        class HomeKitConfigurationException
    }


    Note "Table 5-12 page 80" as N1
    homekit.HapStatusCodes .. N1

class homekit.TLV {
    + {static} encode_dict(data)
    + {static} decode_bytes(data)
}

class homekit.CharacteristicsTypes {
    + __getitem__(self, item)
    + get_short(self, uuid)
    + get_uuid(self, item_name)
}

class homekit.HapStatusCodes {
}

class homekit.Categories {
}
